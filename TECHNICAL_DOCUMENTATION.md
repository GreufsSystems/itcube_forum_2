# Техническая документация  
## Проект: IT-Cube Forum

### Оглавление
1. Описание проекта  
2. Структура проекта  
3. Telegram-боты
   - Бот для привязки аккаунтов (telegram_bind_bot.py)
   - Основной бот для преподавателей (bot.py)
4. Работа с базой данных  
5. Конфигурация  
6. Запуск проекта  
7. Логирование  
8. Зависимости  
9. Безопасность и защита
10. Контакты для поддержки

---

## 1. Описание проекта

**IT-Cube Forum** — это веб-форум с двумя интегрированными Telegram-ботами:
1. Бот для привязки аккаунтов — позволяет пользователям привязывать свои Telegram-аккаунты к форуму и входить через Telegram
2. Основной бот для преподавателей — обеспечивает создание тем и загрузку файлов непосредственно через Telegram

---

## 2. Структура проекта

```
IT-Cube Forum/
│
├── bot/
│   ├── bot.py                   # Основной бот для преподавателей
│   └── telegram_bind_bot.py     # Бот для привязки аккаунтов
│
├── web/
│   └── app.py                   # Веб-приложение (форум)
│
├── templates/                   # HTML шаблоны
├── assets/                      # Статические файлы
├── fonts/                       # Шрифты
├── uploads/                     # Загруженные файлы
├── data/                        # Данные приложения
│
├── database.py                  # Работа с базой данных
├── config.py                    # Конфигурация (токены, настройки)
├── requirements.txt             # Зависимости проекта
├── roles.json                   # Конфигурация ролей
├── directions.json             # Направления форума
├── run_project.bat             # Скрипт запуска проекта
└── view_logs.py                # Утилита просмотра логов
```

---

## 3. Telegram-боты

### Бот для привязки аккаунтов (telegram_bind_bot.py)

#### Основные функции:
- Привязка Telegram-аккаунта к форуму через код (/bind)
- Отвязка аккаунта (/unbind)
- Вход на форум через Telegram (/login)
- Проверка прав доступа пользователей

#### Команды:
- **/start** — приветствие и инструкции
- **/bind <код>** — привязка аккаунта по коду с форума
- **/unbind** — отвязка Telegram-аккаунта
- **/login** — получение ссылки для входа на форум
- **/help** — справка по командам

### Основной бот для преподавателей (bot.py)

#### Основные функции:
- Создание тем на форуме через FSM (Finite State Machine)
- Загрузка файлов и документов
- Модерация контента
- Управление темами по направлениям

#### Команды:
- **/start** — начало работы с ботом
- **/topic** — создание новой темы
- **/cancel** — отмена текущего действия
- **/done** — завершение создания темы
- **/help** — справка по командам

---

## 4. Работа с базой данных

База данных (forum.db) обслуживает оба бота и включает таблицы для:
- Пользователей и их ролей
- Привязок Telegram-аккаунтов
- Тем форума и их статусов
- Загруженных файлов
- Кодов привязки и токенов входа

---

## 5. Конфигурация

Настройки хранятся в `config.py`:
```python
TELEGRAM_MAIN_BOT_TOKEN = "токен_основного_бота"
TELEGRAM_BIND_BOT_TOKEN = "токен_бота_привязки"
UPLOAD_FOLDER = "uploads"
ROLES_PATH = "roles.json"
```

Дополнительные настройки:
- `roles.json` — конфигурация ролей пользователей
- `directions.json` — настройки направлений форума

---

## 6. Запуск проекта

1. Установка зависимостей:
   ```bash
   pip install -r requirements.txt
   ```

2. Запуск проекта:
   ```bash
   # Windows
   run_project.bat

   # Linux/Mac
   python bot/telegram_bind_bot.py &
   python bot/bot.py &
   python web/app.py
   ```

---

## 7. Логирование

Логи доступны через утилиту `view_logs.py`:
```bash
python view_logs.py
```

Логи включают:
- Информацию о запуске/остановке
- Действия пользователей
- Ошибки и исключения
- Сетевые проблемы

---

## 8. Зависимости

Основные зависимости:
- aiogram>=3.0.0
- python-dotenv==1.0.0
- aiohttp>=3.8.5
- flask==2.0.1
- python-telegram-bot==20.7
- requests==2.31.0
- werkzeug==2.0.1

---

## 9. Безопасность и защита

### Проверка браузера
- Валидация User-Agent для предотвращения автоматизированных атак
- Проверка поддержки JavaScript и cookies
- Защита от брутфорс-атак с помощью временных блокировок
- Проверка реферера для предотвращения CSRF-атак

### Защита от хакерских атак
- Защита от SQL-инъекций через параметризованные запросы
- XSS-защита через экранирование пользовательского ввода
- CSRF-токены для всех форм
- Rate limiting для API-эндпоинтов
- Шифрование чувствительных данных
- Защита от DDoS-атак через ограничение запросов
- Безопасное хранение паролей с использованием bcrypt
- Двухфакторная аутентификация через Telegram
- Регулярное резервное копирование базы данных
- Мониторинг подозрительной активности

### Рекомендации по безопасности
1. Регулярно обновлять все зависимости
2. Использовать HTTPS для всех соединений
3. Ограничивать доступ к административным функциям
4. Вести журнал всех критических операций
5. Проводить регулярные проверки безопасности

---

## 10. Контакты для поддержки

- Связь: [@Greufs]
- Репозиторий: [https://github.com/GreufsSystem/itcube_forum]

